w626@W626:~/ERC20$ npx hardhat test test/ProxyTest.js


  代理合约测试

===========================================
开始测试前的准备工作...
1. 获取部署账户： 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
2. 部署逻辑合约...
3. 逻辑合约部署成功，地址： 0x5FbDB2315678afecb367f032d93F642f64180aa3
4. 部署代理合约，关联到逻辑合约...
5. 代理合约部署成功，地址： 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
6. 代理合约关联的逻辑合约地址： 0x5FbDB2315678afecb367f032d93F642f64180aa3
7. 代理合约初始计数器值： 0
8. 逻辑合约初始计数器值： 0
准备工作完成！

=== 测试场景1：通过代理合约增加计数器并保留状态 ===
- 初始计数值： 0
- 调用代理合约的increment函数...
- 交易哈希： 0x567f049dd8e0ee7937b531f16d43251daed0e9503824a40853f436dc5b7d484f
- 交易已确认
- 第一次调用后计数值： 1
- 再次调用代理合约的increment函数...
- 交易哈希： 0xa2ce1fdeb112843f53cc15791eb6ee6936fc2dfc7700d3ba1c912deb1c4b6c59
- 交易已确认
- 第二次调用后计数值： 2
  ✅ 测试场景1通过：计数器状态正确保留
    ✔ 应该通过代理合约增加计数器并保留状态

===========================================
开始测试前的准备工作...
1. 获取部署账户： 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
2. 部署逻辑合约...
3. 逻辑合约部署成功，地址： 0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9
4. 部署代理合约，关联到逻辑合约...
5. 代理合约部署成功，地址： 0x5FC8d32690cc91D4c39d9d3abcBD16989F875707
6. 代理合约关联的逻辑合约地址： 0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9
7. 代理合约初始计数器值： 0
8. 逻辑合约初始计数器值： 0
准备工作完成！

=== 测试场景2：验证代理合约和逻辑合约的状态是分离的 ===
- 通过代理合约调用increment函数...
- 交易哈希： 0x1fc227f90878e8026e3de83afbb4a2626d1b8a1fdd29382a3c3aa68412eba2b9
- 代理合约计数值： 1
- 逻辑合约计数值： 0
  ✅ 测试场景2通过：代理合约和逻辑合约状态成功分离
   这证明了delegatecall的特性：执行逻辑合约的代码，但操作代理合约的存储
    ✔ 应该验证代理合约和逻辑合约的状态是分离的

===========================================
开始测试前的准备工作...
1. 获取部署账户： 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
2. 部署逻辑合约...
3. 逻辑合约部署成功，地址： 0xa513E6E4b8f2a923D98304ec87F64353C4D5C853
4. 部署代理合约，关联到逻辑合约...
5. 代理合约部署成功，地址： 0x2279B7A0a67DB372996a5FaB50D91eAA73d2eBe6
6. 代理合约关联的逻辑合约地址： 0xa513E6E4b8f2a923D98304ec87F64353C4D5C853
7. 代理合约初始计数器值： 0
8. 逻辑合约初始计数器值： 0
准备工作完成！

=== 测试场景3：更新逻辑合约地址（合约升级演示） ===
- 部署新的逻辑合约实例（模拟合约升级）...
- 新逻辑合约部署成功，地址： 0x8A791620dd6260079BF849Dc5567aDC3F2FdC318
- 当前代理合约使用的逻辑合约地址： 0xa513E6E4b8f2a923D98304ec87F64353C4D5C853
- 更新代理合约的逻辑合约地址...
- 交易哈希： 0xbcaf194f5bdb0839162cdd51913aeef1fb664fa64fe63d8ecd712229b6cca697
- 更新后的逻辑合约地址： 0x8A791620dd6260079BF849Dc5567aDC3F2FdC318
- 通过新逻辑合约调用increment函数...
- 调用后计数值： 1
  ✅ 测试场景3通过：成功更新逻辑合约地址并正常工作
   这演示了代理模式如何实现合约的可升级性
    ✔ 应该能够更新逻辑合约地址


  3 passing (11s)